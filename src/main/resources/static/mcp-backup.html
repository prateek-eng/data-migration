<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP-Integrated Database Backup System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .mcp-info {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .mcp-tools {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mcp-tool-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }
        
        .mcp-tool-card h3 {
            margin-top: 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mcp-tool-card.postgresql {
            border-left-color: #3366cc;
        }
        
        .mcp-tool-card.mongodb {
            border-left-color: #00ed64;
        }
        
        .mcp-tool-card.coordination {
            border-left-color: #ff6b35;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .card h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
            color: white;
        }
        
        .btn-info:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
        }
        
        .command-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }
        
        .command-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .results h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }
        
        .json-display {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            border-left: 4px solid #667eea;
        }
        
        .mcp-flow {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .flow-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .flow-step {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border: 2px solid #667eea;
        }
        
        .flow-step-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîÑ REAL MCP-Integrated Database Backup System</h1>
        <p>PostgreSQL ‚Üí MongoDB Backup Powered by REAL MCP Tools Coordination</p>
    </div>
    
    <div class="mcp-info">
        <h2>üéØ REAL MCP Tools Architecture</h2>
        <p>This system demonstrates how <strong>REAL MCP (Model Context Protocol) tools</strong> coordinate to perform intelligent database backup operations. The PostgreSQL MCP tool analyzes your source database, the MongoDB MCP tool analyzes your target cluster, and they coordinate to create an optimal backup strategy. This is a REAL MCP integration demonstration!</p>
    </div>
    
    <div class="mcp-tools">
        <div class="mcp-tool-card postgresql">
            <h3>üêò PostgreSQL MCP Tool</h3>
            <p><strong>Role:</strong> Analyzes PostgreSQL database state</p>
            <p><strong>Capabilities:</strong></p>
            <ul>
                <li>Table schema analysis</li>
                <li>Record count extraction</li>
                <li>Sample data collection</li>
                <li>Dependency mapping</li>
            </ul>
        </div>
        
        <div class="mcp-tool-card mongodb">
            <h3>üçÉ MongoDB MCP Tool</h3>
            <p><strong>Role:</strong> Analyzes MongoDB cluster state</p>
            <p><strong>Capabilities:</strong></p>
            <ul>
                <li>Collection analysis</li>
                <li>Document count extraction</li>
                <li>Schema validation</li>
                <li>Cluster health check</li>
            </ul>
        </div>
        
        <div class="mcp-tool-card coordination">
            <h3>ü§ù MCP Coordination Engine</h3>
            <p><strong>Role:</strong> Coordinates between MCP tools</p>
            <p><strong>Capabilities:</strong></p>
            <ul>
                <li>State comparison</li>
                <li>Backup planning</li>
                <li>Dependency resolution</li>
                <li>Execution coordination</li>
            </ul>
        </div>
    </div>
    
    <div class="mcp-flow">
        <h3>üîÑ MCP Backup Flow</h3>
        <div class="flow-steps">
            <div class="flow-step">
                <div class="flow-step-number">1</div>
                <h4>PostgreSQL MCP Analysis</h4>
                <p>Analyzes current database state, schemas, and data</p>
            </div>
            <div class="flow-step">
                <div class="flow-step-number">2</div>
                <h4>MongoDB MCP Analysis</h4>
                <p>Analyzes target cluster state and existing collections</p>
            </div>
            <div class="flow-step">
                <div class="flow-step-number">3</div>
                <h4>MCP Coordination</h4>
                <p>Tools coordinate to create optimal backup strategy</p>
            </div>
            <div class="flow-step">
                <div class="flow-step-number">4</div>
                <h4>Execution</h4>
                <p>MCP-planned backup executed with real-time coordination</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="card">
            <h3>üìä MCP Analysis & Planning</h3>
            <p>Use MCP tools to analyze both databases and create backup plans.</p>
            <div class="button-group">
                <button class="btn btn-info" onclick="getMCPStatus()">MCP Status</button>
                <button class="btn btn-primary" onclick="analyzeWithMCP()">Analyze with MCP</button>
                <button class="btn btn-info" onclick="checkMCPHealth()">MCP Health</button>
            </div>
        </div>
        
        <div class="card">
            <h3>üíæ MCP Backup Operations</h3>
            <p>Execute MCP-coordinated backup operations from PostgreSQL to MongoDB.</p>
            <div class="button-group">
                <button class="btn btn-success" onclick="executeMCPBackup()">Execute MCP Backup</button>
                <button class="btn btn-primary" onclick="showMCPFlow()">Show MCP Flow</button>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h3>üéØ MCP Command Interface</h3>
        <p>Use natural language commands to control the MCP-integrated system.</p>
        <input type="text" class="command-input" id="commandInput" 
               placeholder="Type: 'backup postgres to mongodb' or 'analyze with mcp tools' or 'mcp backup status'"
               onkeypress="handleCommandKeyPress(event)">
        <button class="btn btn-primary" onclick="executeMCPCommand()">Execute MCP Command</button>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <h3>MCP Tools Coordinating...</h3>
        <p>PostgreSQL MCP ‚Üí MongoDB MCP ‚Üí Coordination Engine ‚Üí Execution</p>
    </div>
    
    <div class="results" id="results" style="display: none;">
        <h3>üìã MCP Operation Results</h3>
        <div id="resultContent"></div>
    </div>
    
    <script>
        const API_BASE = '/api/real-mcp-backup';
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function showResults(data, title = 'MCP Operation Result') {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultContent');
            
            let html = `<h4>${title}</h4>`;
            
            if (data.status) {
                const statusClass = data.status === 'success' ? 'success' : 
                                  data.status === 'error' ? 'error' : 
                                  data.status === 'in_progress' ? 'warning' : 'info';
                html += `<div class="status ${statusClass}">Status: ${data.status}</div>`;
            }
            
            if (data.message) {
                html += `<p><strong>Message:</strong> ${data.message}</p>`;
            }
            
            if (data.error) {
                html += `<div class="status error">Error: ${data.error}</div>`;
            }
            
            // Show MCP tool information if available
            if (data.mcpTools) {
                html += `<h5>üîß MCP Tools Used:</h5>`;
                html += `<div class="status info">${data.mcpTools}</div>`;
            }
            
            // Display the full response data
            html += `<h5>üìä Full MCP Response:</h5>`;
            html += `<div class="json-display">${JSON.stringify(data, null, 2)}</div>`;
            
            contentDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }
        
        function showError(message) {
            showResults({ status: 'error', error: message }, 'MCP Operation Error');
        }
        
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    method: options.method || 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    body: options.body ? JSON.stringify(options.body) : undefined
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                throw new Error(`MCP request failed: ${error.message}`);
            }
        }
        
        async function getMCPStatus() {
            showLoading();
            try {
                const data = await makeRequest(`${API_BASE}/status`);
                showResults(data, 'MCP Tools Status');
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }
        
        async function analyzeWithMCP() {
            showLoading();
            try {
                const data = await makeRequest(`${API_BASE}/command`, {
                    method: 'POST',
                    body: { command: 'analyze with mcp tools' }
                });
                showResults(data, 'MCP Analysis Results');
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }
        
        async function checkMCPHealth() {
            showLoading();
            try {
                const data = await makeRequest(`${API_BASE}/health`);
                showResults(data, 'MCP Health Check');
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }
        
        async function executeMCPBackup() {
            showLoading();
            try {
                const data = await makeRequest(`${API_BASE}/execute`, {
                    method: 'POST'
                });
                showResults(data, 'MCP Backup Execution Results');
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }
        
        function showMCPFlow() {
            showResults({
                status: 'info',
                message: 'MCP Backup Flow Visualization',
                mcpFlow: {
                    step1: 'PostgreSQL MCP analyzes source database',
                    step2: 'MongoDB MCP analyzes target cluster',
                    step3: 'MCP tools coordinate backup strategy',
                    step4: 'Coordinated execution with real-time feedback'
                }
            }, 'MCP Backup Flow');
        }
        
        async function executeMCPCommand() {
            const command = document.getElementById('commandInput').value.trim();
            if (!command) {
                showError('Please enter an MCP command');
                return;
            }
            
            showLoading();
            try {
                const data = await makeRequest(`${API_BASE}/command`, {
                    method: 'POST',
                    body: { command: command }
                });
                showResults(data, `MCP Command: "${command}"`);
                document.getElementById('commandInput').value = '';
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }
        
        function handleCommandKeyPress(event) {
            if (event.key === 'Enter') {
                executeMCPCommand();
            }
        }
        
        // Auto-check MCP status on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                getMCPStatus();
            }, 1000);
        });
    </script>
</body>
</html>
